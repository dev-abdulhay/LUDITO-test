# LUDITO-test

## Описание проекта

Данный проект представляет собой REST API для финансового продукта, реализованного на базе Java Spring Boot. В системе
предусмотрены пользователи, у каждого из которых есть баланс. Баланс пользователя изменяется посредством проведения
транзакций.

### Основной функционал:

- Создание и хранение пользователей с балансом.
- Учет транзакций, влияющих на баланс пользователей.
- Поддержка создания, редактирования и получения пользователей через REST API.
- Поддержка создания транзакций через REST API.
- Получение списка транзакций с возможностью фильтрации по пользователю и интервалу дат.

## Требования к реализации

1. **Таблицы в базе данных PostgreSQL:**
    - Таблица пользователей (`users`) с необходимыми полями (например, id, имя, email, баланс).
    - Таблица транзакций (`transactions`) с необходимыми полями (например, id, user_id, сумма, тип операции, дата).
    - Таблицы заполнены тестовыми (моковыми) данными.

2. **REST API:**
    - Методы для пользователей:
        - Создание пользователя.
        - Редактирование пользователя.
        - Получение информации о пользователях.
    - Методы для транзакций:
        - Создание транзакции.
        - Получение списка транзакций:
            - Все транзакции.
            - По конкретному пользователю.
            - По интервалу дат.

3. **Используемые технологии:**
    - Java 21 и Spring Boot.
    - Spring Data JPA для работы с базой данных.
    - PostgreSQL как СУБД.

4. **Рекомендуемые дополнения (необязательно):**
    - Валидация данных и обработка ошибок.
    - Реализация безопасности (например, JWT аутентификация).

## Инструкция по запуску проекта

### Предварительные требования:

- Установлен Docker и Docker Compose.
- Порт 5433 свободен для PostgreSQL.

### Шаги запуска:

1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/dev-abdulhay/LUDITO-test.git
   cd LUDITO-test
   ```

2. Постройте и запустите контейнер с приложением:
   ```bash
   docker compose up --build
   ```

3. Приложение будет доступно по адресу:
   ```
   http://localhost:8081
   ```

## API документация

Проект включает интерактивную документацию API через Swagger UI, доступную по адресу:

   ```
   http://localhost:8081/swagger-ui/index.html
   ```

## Тестирование REST API

- Для тестирования API рекомендуется использовать такие инструменты, как Postman или curl.
- Базовые эндпоинты:

## Описание контроллеров REST API

В проекте реализованы следующие основные контроллеры с набором соответствующих REST методов для работы с пользователями,
транзакциями и финансовыми операциями:

### 1. AuthController

Отвечает за регистрацию, аутентификацию и управление сессиями пользователей.

- `POST /api/v1/auth/register` — регистрация нового пользователя.
- `POST /api/v1/auth/login` — инициализация процесса входа (логина).
- `POST /api/v1/auth/login/verify` — верификация логина (например, по коду).
- `POST /api/v1/auth/logout` — выход из системы (логаут).

### 2. UserController

Работает с информацией пользователей.

- `GET /api/v1/user` — получить информацию о текущем пользователе (авторизованном).
- `POST /api/v1/user/update` — обновить информацию пользователя.
- `POST /api/v1/user/password/change` — смена пароля пользователя.

### 3. WalletController

Обрабатывает операции с "кошельками" пользователей, где хранится баланс в различных валютах.

- `GET /api/v1/wallet` — получить список всех кошельков текущего пользователя.
- `POST /api/v1/wallet/one` — получить информацию об одном кошельке по UUID.
- `POST /api/v1/wallet/add` — добавить новый кошелек.

### 4. TransferController

Отвечает за выполнение инициализации, расчёта комиссии и непосредственного проведения переводов (транзакций) между
кошельками пользователей.

- `POST /api/v1/transfer/fee` — рассчитать комиссию перевода.
- `POST /api/v1/transfer/init` — инициализировать перевод.
- `POST /api/v1/transfer/execute` — выполнить перевод средств.

### 5. HistoryController

Предназначен для поиска и получения истории транзакций (операций) с поддержкой фильтров.

- `POST /api/v1/history/search` — поиск транзакций с возможностью фильтрации по пользователю, дате и другим параметрам.

---

Все контроллеры используют аннотации для валидации входящих данных (`@Valid`) и возвращают обёрнутые в `ResponseEntity`
стандартизированные ответы.

Для базового API префикс `/api/v1/` определяется константами и применяется на уровне роутинга.  
Эндпоинты разбиты по модулям: авторизация, пользователи, кошельки, переводы и история транзакций.

Этот подход обеспечивает ясное разделение ответственности и удобство поддержки и расширения REST API финансового
продукта.

---

# Руководство по процессу аутентификации

В этом разделе описывается, как аутентифицировать пользователей с помощью двухэтапной проверки входа, реализованной в API этого проекта.

## Шаг 1: Инициация входа

Отправьте `POST` запрос на эндпоинт для входа с учетными данными пользователя:
```bash
curl -X POST \
'http://localhost:8081/web/admin/api/v1/auth/login' \
-H 'accept: */*' \
-H 'Content-Type: application/json' \
-d '{
"username": "user1",
"password": "password1"
}'
```
### Ответ

При успешной обработке сервер возвращает JSON с:

- `identity`: уникальный идентификатор сессии входа.
- `message`: сообщение с подтверждением и OTP-кодом (одноразовым паролем), который пользователь должен ввести для подтверждения.

Пример:
```json
{
  "identity": "5d154e58-c500-4c9f-bdb5-65eb1e0da34b",
  "message": "Вход инициализирован успешно. Пожалуйста, подтвердите свой OTP код. (88534)"
}
```
## Шаг 2: Подтверждение OTP кода

Чтобы завершить вход, отправьте `POST` запрос на эндпоинт подтверждения с полученным `identity` и OTP кодом:
```bash
curl -X POST \
'http://localhost:8081/web/admin/api/v1/auth/login/verify' \
-H 'accept: */*' \
-H 'Content-Type: application/json' \
-d '{
"identity": "5d154e58-c500-4c9f-bdb5-65eb1e0da34b",
"code": "88534"
}'
```
### Ответ

Если проверка успешна, сервер возвращает:

- `accessToken`: JWT токен доступа для аутентификации последующих запросов.
- `refreshToken`: JWT токен обновления для получения новых токенов доступа.
- `accessTokenExpire`: время истечения срока действия токена доступа.
- `refreshTokenExpire`: время истечения срока действия токена обновления.

Пример:
```json
{
  "accessToken": "eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1c2VyMSIsImV4cCI6MTc1MzIwMTAzMSwidXNlcklkIjoiMDg3N2E1MmMtZjRhZS00MmM3LTg1NzItN2ExZjUyOWYyNjMxIn0.YPMIMkm2JdN3xn33n1exWKlWJ9df2KeyUxjIV0Y1Wus",
  "refreshToken": "eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1c2VyMSIsImV4cCI6MTc1NTcyNTgzMX0.4ztasTDg8q_zVSW3PZQLID_vkSXo_TjAK7IR4IDImh8",
  "accessTokenExpire": "2025-07-22T21:17:11",
  "refreshTokenExpire": "2025-08-21T02:37:11"
}
```
## Использование токена доступа

Включайте `accessToken` в заголовок `X-Auth-Token` (в виде ApiKey) для всех API-запросов, требующих аутентификации, например:
```

X-Auth-Token: eyJhbGciOiJ...
```
Этот токен аутентифицирует пользователя и предоставляет доступ к защищённым ресурсам API.

---

Двухэтапная аутентификация с проверкой OTP обеспечивает надежный и безопасный вход в систему, благодаря чему реализован строгий контроль доступа к API.



# Руководство по процессу перевода

В этом разделе описывается трехэтапный процесс выполнения перевода с помощью API.

---

## Шаг 1: Расчет комиссии за перевод

Отправьте POST-запрос на эндпоинт `/transfer/fee`, чтобы вычислить комиссию и суммы, участвующие в переводе.

### Запрос
```bash
curl -X POST \
'http://localhost:8081/web/admin/api/v1/transfer/fee' \
-H 'accept: */*' \
-H 'X-Auth-Token: <accessToken>' \
-H 'Content-Type: application/json' \
-d '{
"debitAccountId": "d3823827-da96-4540-b874-0999ea4d5c76",
"creditAccountId": "71808f5e-925d-47f6-83e0-ee11ac6652f4",
"creditAccount": "",
"operationType": "OWN2OTHER",
"amount": 500000,
"description": "First Transfer"
}'
```
### Ответ

Сервер возвращает сводку по суммам перевода, включая комиссию:
```json
{
"commissionAmount": 5000,
"creditAmount": 500000,
"debitAmount": 505000
}
```
- `commissionAmount`: комиссия за перевод.
- `creditAmount`: сумма, которую получит получатель.
- `debitAmount`: общая сумма, которая будет списана с отправителя (сумма перевода + комиссия).

---

## Шаг 2: Инициализация перевода

Отправьте POST-запрос на эндпоинт `/transfer/init` с теми же данными перевода, чтобы создать и инициализировать транзакцию.

### Запрос
```bash
curl -X POST \
'http://localhost:8081/web/admin/api/v1/transfer/init' \
-H 'accept: */*' \
-H 'X-Auth-Token: <accessToken>' \
-H 'Content-Type: application/json' \
-d '{
"debitAccountId": "d3823827-da96-4540-b874-0999ea4d5c76",
"creditAccountId": "71808f5e-925d-47f6-83e0-ee11ac6652f4",
"creditAccount": "",
"operationType": "OWN2OTHER",
"amount": 500000,
"description": "First Transfer"
}'
```
### Ответ

Возвращается уникальный идентификатор `transferId`, представляющий инициализированный перевод:
```json
{
"transferId": "e3575287-a990-42ee-9827-f2bffef90759"
}
```
---

## Шаг 3: Выполнение перевода

Отправьте POST-запрос на `/transfer/execute` с `transferId`, чтобы провести сам перевод.

### Запрос
```bash
curl -X POST \
'http://localhost:8081/web/admin/api/v1/transfer/execute' \
-H 'accept: */*' \
-H 'X-Auth-Token: <accessToken>' \
-H 'Content-Type: application/json' \
-d '{
"transferId": "e3575287-a990-42ee-9827-f2bffef90759"
}'
```
### Ответ

Подтверждение успешного выполнения перевода:
```json
{
"message": "Transfer executed successfully"
}
```
---

## Важные примечания

- Всегда включайте валидный `X-Auth-Token` (токен аутентификации) в заголовках запросов.
- Используйте UUIDы точно, как возвращены на предыдущих шагах, для поддержания целостности запросов.
- Многоступенчатый процесс обеспечивает проверку, правильное списание комиссии и безопасную обработку перевода.



# Руководство по поиску истории транзакций

В этом разделе описывается, как выполнять поиск истории транзакций через API в двух распространенных сценариях.

---

## Шаг 1: Поиск истории транзакций по типу

Отправьте POST-запрос на эндпоинт `/history/search` с указанием типа операции и параметров пагинации для получения списка соответствующих операций.

### Запрос
```bash
curl -X POST \
'http://localhost:8081/web/admin/api/v1/history/search' \
-H 'accept: */*' \
-H 'X-Auth-Token: <accessToken>' \
-H 'Content-Type: application/json' \
-d '{
"type": "OWN2OTHER",
"paging": {
"page": 0,
"size": 10
}
}'
```
### Ответ

В ответе возвращается массив операций, соответствующих фильтру, с подробной информацией — UUID, статус, суммы и описание. Также включена информация о пагинации.
```json
{
"operations": [
{
"uuid": "0f4de4df-d1bb-42e9-8bfc-8694bebd6406",
"order": 0,
"status": "INIT",
"type": "OWN2OTHER",
"creditWalletUuid": "71808f5e-925d-47f6-83e0-ee11ac6652f4",
"debitWalletUuid": "d3823827-da96-4540-b874-0999ea4d5c76",
"creditAmount": 500000,
"debitAmount": 505000,
"commissionAmount": 5000,
"userUuid": "d60bce90-ee97-49c4-aee3-ac2ac2c1d8f2",
"executeDate": null,
"description": "First Transfer"
},
{
"uuid": "e3575287-a990-42ee-9827-f2bffef90759",
"order": 0,
"status": "SUCCESS",
"type": "OWN2OTHER",
"creditWalletUuid": "71808f5e-925d-47f6-83e0-ee11ac6652f4",
"debitWalletUuid": "d3823827-da96-4540-b874-0999ea4d5c76",
"creditAmount": 500000,
"debitAmount": 505000,
"commissionAmount": 5000,
"userUuid": "d60bce90-ee97-49c4-aee3-ac2ac2c1d8f2",
"executeDate": "2025-07-22 03:19:02",
"description": "First Transfer"
}
],
"paging": {
"page": 0,
"size": 10
}
}
```
- Поле `status` обозначает текущий статус перевода (например, `INIT`, `SUCCESS`).
- `executeDate` равен null, если перевод еще не завершен.

---

## Шаг 2: Поиск истории транзакций по типу и диапазону дат

Вы также можете фильтровать историю транзакций по типу и по определённому диапазону дат, указав `fromDate` и `toDate`.

### Запрос
```bash
curl -X POST \
'http://localhost:8081/web/admin/api/v1/history/search' \
-H 'accept: */*' \
-H 'X-Auth-Token: <accessToken>' \
-H 'Content-Type: application/json' \
-d '{
"type": "OWN2OTHER",
"fromDate": "2025-07-21 17:39:16",
"toDate": "2025-07-23 17:39:16",
"paging": {
"page": 0,
"size": 10
}
}'
```
### Ответ

Сервер возвращает транзакции, подходящие под оба фильтра: тип операции и диапазон дат.
```json
{
"operations": [
{
"uuid": "e3575287-a990-42ee-9827-f2bffef90759",
"order": 0,
"status": "SUCCESS",
"type": "OWN2OTHER",
"creditWalletUuid": "71808f5e-925d-47f6-83e0-ee11ac6652f4",
"debitWalletUuid": "d3823827-da96-4540-b874-0999ea4d5c76",
"creditAmount": 500000,
"debitAmount": 505000,
"commissionAmount": 5000,
"userUuid": "d60bce90-ee97-49c4-aee3-ac2ac2c1d8f2",
"executeDate": "2025-07-22 03:19:02",
"description": "First Transfer"
}
],
"paging": {
"page": 0,
"size": 10
}
}
```
---

## Важные примечания

- В каждый запрос необходимо включать валидный заголовок `X-Auth-Token` с токеном аутентификации.
- Объект `paging` контролирует пагинацию: `page` — номер страницы (начинается с 0), `size` — количество элементов на странице.
- Поля даты должны быть представлены в формате `"yyyy-MM-dd HH:mm:ss"`.



---





